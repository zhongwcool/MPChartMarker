# 中文字符显示限制功能说明

## 功能概述

为了优化标记的视觉效果和避免在小标记中显示中文字符造成的显示问题，我们现在实现了中文字符显示的形状限制功能。

## 限制规则

### 支持中文字符的形状
- ✅ **圆形 (CIRCLE)** - 完全支持中文字符显示
- ✅ **菱形 (DIAMOND)** - 完全支持中文字符显示

### 支持英文字符的形状
- ✅ **圆形 (CIRCLE)** - 支持英文/数字/符号显示
- ✅ **菱形 (DIAMOND)** - 支持英文/数字/符号显示
- ✅ **矩形 (RECTANGLE)** - 支持英文/数字/符号显示，**固定12dp大小的直角正方形，不可调整**

### 不支持字符显示的形状
- ❌ **三角形 (TRIANGLE_UP/TRIANGLE_DOWN)** - 不支持任何文字显示（纯图标）
- ❌ **星形 (STAR)** - 不支持任何文字显示（纯图标）

### 特殊情况
- ✅ **TEXT ONLY (NONE)** - 不受任何限制，支持所有字符类型的多字符显示
- ✅ **DOT/CUSTOM_ICON** - 这些形状本身不支持文字显示，不受影响

## 字符类型处理

### 完全支持的字符类型（所有形状）
- 英文字母：A-Z, a-z
- 数字：0-9
- 符号：★、☆、!、@、#等

### 限制显示的字符类型（仅限特定形状）
- 中文汉字：只有圆形和菱形支持
- 中英混合文本：如果包含中文，按中文规则处理

## 实现逻辑

### 1. 中文字符检测
```java
public static boolean containsChineseCharacters(String text) {
    // 检查文本中是否包含任何中文字符
    // 支持CJK统一汉字、扩展区、兼容汉字等
}
```

### 2. 形状支持检查
```java
public static boolean isChineseSupportedShape(MarkerShape shape) {
    return shape == MarkerShape.CIRCLE || shape == MarkerShape.DIAMOND;
}
```

### 3. 文字处理逻辑
```java
public static String processMarkerText(String text, MarkerShape shape) {
    if (shape == MarkerShape.NONE) {
        return text; // TEXT ONLY 不限制
    }
    
    if (containsChineseCharacters(text) && !isChineseSupportedShape(shape)) {
        return ""; // 包含中文但形状不支持，隐藏文字
    }
    
    return getFirstCharacter(text); // 其他情况限制为单字符
}
```

## 使用示例

### 支持中文的标记
```java
// 圆形标记 - 显示"买"
MarkerData.createCustomMarker(date, "买入", 
    MarkerPresets.googleBlue()) // 圆形，支持中文

// 菱形标记 - 显示"卖"
MarkerData.createCustomMarker(date, "卖出", 
    MarkerPresets.diamondPurple()) // 菱形，支持中文
```

### 支持英文的标记
```java
// 矩形标记 - 显示"S"，固定12dp直角正方形
MarkerData.createCustomMarker(date, "SELL", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.RECTANGLE) // 英文字符，固定12dp直角正方形
        .backgroundColor(Color.RED)
        .markerSize(12f) // 这个设置会被忽略，实际显示为12dp
        .build())
```

### 不支持文字的标记（纯图标）
```java
// 三角形标记 - 不显示任何文字
MarkerData.createCustomMarker(date, "任何文字", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.TRIANGLE_UP) // 纯图标，不显示文字
        .backgroundColor(Color.GREEN)
        .markerSize(12f) // 这个设置有效，控制三角形大小
        .build())

// 星形标记 - 不显示任何文字
MarkerData.createCustomMarker(date, "任何文字", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.STAR) // 纯图标，不显示文字
        .backgroundColor(Color.YELLOW)
        .markerSize(15f) // 这个设置有效，控制星形大小
        .build())
```

### TEXT ONLY 标记（不受限制）
```java
// 纯文字标记 - 显示完整文字
new MarkerData(date, "中文业绩公告", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.NONE) // TEXT ONLY 不受限制
        .textColor(Color.BLUE)
        .build())
```

## 设计考虑

### 1. 视觉效果
- 圆形和菱形有足够的空间和良好的对称性来展示中文字符
- **矩形标记固定为16dp正方形**：确保视觉一致性，无论配置的markerSize为多少
- **三角形和星形为纯图标**：专注于形状本身的表达，不承载文字信息
- 各种形状有明确的视觉分工，避免功能重叠

### 2. 用户体验
- 避免在不合适的形状中强制显示中文字符导致的可读性问题
- 保持英文、数字、符号在所有形状中的正常显示

### 3. 向后兼容
- 现有代码无需修改
- TEXT ONLY 功能保持完全兼容
- 英文和数字标记不受影响

## 注意事项

1. **混合文本处理**：如果文本中包含中文字符，整个文本按中文规则处理
2. **Unicode 支持**：正确识别各种 CJK 字符区间
3. **性能优化**：字符检测逻辑经过优化，不影响渲染性能
4. **测试覆盖**：包含完整的示例代码演示各种情况

## 测试场景

示例代码中包含以下测试场景：
- 圆形和菱形显示中文字符
- 其他形状遇到中文字符时隐藏文字
- 英文、数字、符号在所有形状中正常显示
- TEXT ONLY 支持中英混合文本
- 混合文本的处理逻辑
- 向后兼容性验证 