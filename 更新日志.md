# K线标记系统更新日志

## v3.3.4 - 增加默认标记大小 (2024-01-XX)

### 🎯 基础功能改进
- **增加默认标记大小**：将所有预设标记的默认大小从12dp增加到16dp
  - 解决了标记过小、不够醒目的问题
  - 提供更好的视觉效果和用户体验
  - 无需手动配置即可获得理想的显示大小

### 📊 具体修改
- **圆形、菱形、三角形、星形、箭头标记**：markerSize从12f增加到16f
- **矩形标记**：固定大小从12dp增加到16dp
- **文字大小**：textSize从8f增加到10f，保持比例协调
- **纯文字标记**：textSize保持12f（相对更大）
- **示例代码统一化**：所有演示标记都使用16dp，确保"买"、"A"、"1"等标记大小完全一致

### 🎨 设计理念
- **可见性优先**：标记应该足够大以确保清晰可见
- **统一标准**：所有预设标记使用相同的基础大小
- **开箱即用**：无需额外配置即可获得理想的显示效果
- **比例协调**：文字大小与标记大小保持合理比例
- **视觉一致性**：解决不同字符类型显示大小不一致的问题

### 📝 影响范围
#### 受影响的预设方法：
- `MarkerPresets.buy()`, `sell()`, `warning()`, `info()` 等所有预设方法
- `MarkerPresets.googleBlue()`, `googleRed()` 等颜色预设方法
- `MarkerPresets.fromColorIndex()` 方法
- `RectangleTextRenderer` 的固定大小

#### 不受影响：
- 手动指定`markerSize`的自定义配置
- 现有的自定义标记（继续使用指定的大小）
- 圆点标记（仍然是4dp，保持小巧）

### 🔄 向后兼容
- **完全兼容**：现有代码无需修改
- **仅影响默认值**：只有使用预设方法的标记会变大
- **可以覆盖**：仍然可以通过自定义配置指定其他大小

### 🎯 使用效果
```java
// 现在这些标记都更大更醒目了
MarkerData.createCustomMarker(date, "买", MarkerPresets.googleBlue());   // 16dp圆形
MarkerData.createCustomMarker(date, "卖", MarkerPresets.googleRed());    // 16dp圆形
MarkerData.createCustomMarker(date, "S", MarkerPresets.sell());          // 16dp矩形

// 如需其他大小，仍然可以自定义
MarkerData.createCustomMarker(date, "小", 
    MarkerPresets.customize(MarkerPresets.googleBlue())
        .markerSize(12f)  // 自定义为12dp
        .build());
```

---

## v3.3.3 - 圆形标记大小统一 (2024-01-XX)

### 🎯 视觉优化
- **圆形大小统一**：圆形标记现在使用固定大小，不受文字内容影响
  - 中文字符和英文字符显示的圆形大小完全一致
  - 消除了因字符宽度差异导致的圆形大小不一致问题
  - 提供更加整齐、统一的视觉效果

### 🔧 技术实现
- 修改了`CircleTextRenderer`类：
  - 移除动态尺寸计算逻辑，改为使用固定半径
  - `radius = markerSize * density / 2f`（固定公式）
  - `getMarkerWidth()`和`getMarkerHeight()`返回固定值
  - 简化了计算逻辑，提高了性能

### 📊 效果对比
**修改前：**
- 中文字符"买"：圆形较大（因为汉字较宽）
- 英文字符"B"：圆形较小（因为字母较窄）
- 数字"1"：圆形最小（因为数字最窄）

**修改后：**
- 所有字符：圆形大小完全一致
- 由`markerSize`配置统一控制
- 视觉效果更加整齐划一

### 🎨 设计理念
- **一致性优先**：统一的视觉效果比自适应尺寸更重要
- **简洁美观**：避免因内容差异造成的视觉混乱
- **易于使用**：配置简单，效果可预期

### 📝 使用示例
```java
// 现在所有圆形标记都是相同大小
MarkerData chineseMarker = MarkerData.createCustomMarker(date, "买", 
    MarkerPresets.googleBlue()); // 12dp圆形

MarkerData englishMarker = MarkerData.createCustomMarker(date, "B", 
    MarkerPresets.googleBlue()); // 同样12dp圆形

MarkerData numberMarker = MarkerData.createCustomMarker(date, "1", 
    MarkerPresets.googleBlue()); // 同样12dp圆形
```

---

## v3.3.2 - 移除CROSS标记 (2024-01-XX)

### 🗑️ 功能移除
- **移除CROSS标记**：完全移除效果较差的十字标记功能
  - 删除`MarkerShape.CROSS`枚举项
  - 删除`CrossRenderer.java`渲染器文件
  - 移除`MarkerPresets.cross()`预设方法
  - 从`MarkerRendererFactory`中移除相关注册
  - 清理示例代码中的CROSS标记使用

### 🎯 移除原因
- 十字标记视觉效果较差，与其他几何形状相比缺乏美观性
- 功能重复度较高，DOT标记已能满足类似的标点需求
- 简化系统复杂度，专注于效果更好的标记形状
- 提升整体标记系统的视觉质量

### 🔧 技术清理
- 完全移除`CrossRenderer`类及其相关代码
- 清理`MarkerShape`枚举中的CROSS项
- 移除预设方法和工厂注册
- 更新示例代码，移除相关演示
- 更新文档说明

### ⚠️ 兼容性影响
- **不向后兼容**：使用`MarkerShape.CROSS`的现有代码需要修改
- 建议替换方案：
  - 使用`MarkerShape.DOT`作为简单标点
  - 使用`MarkerShape.CIRCLE`配合小尺寸作为替代
  - 考虑使用其他几何形状标记

### 📊 标记系统现状
移除CROSS后，当前支持的标记形状：
- **几何形状**：圆形、矩形、菱形、三角形、星形
- **简单标记**：圆点
- **方向标记**：箭头（上下）
- **文字标记**：TEXT ONLY
- **自定义**：CUSTOM_ICON

---

## v3.3.1 - 矩形直角风格优化 (2024-01-XX)

### 🎨 视觉优化
- **矩形直角风格**：将矩形标记从圆角矩形改为直角矩形
  - 移除了4dp的圆角效果，改为完全的直角矩形
  - 提供更加干净、简洁的视觉效果
  - 与其他几何形状（圆形、菱形、三角形、星形）形成更好的对比
  - 保持12dp固定正方形尺寸不变

### 🔧 技术实现
- 修改了`RectangleTextRenderer`类：
  - 将`canvas.drawRoundRect()`改为`canvas.drawRect()`
  - 移除圆角半径参数（之前为4dp）
  - 代码更加简洁，性能略有提升

### 🎯 视觉效果
- 矩形标记现在显示为完全的直角正方形
- 更加突出几何形状的特点
- 与圆形的圆润风格形成鲜明对比
- 适合需要强调边界感的场景

---

## v3.3.0 - 形状功能重新定义 (2024-01-XX)

### 🆕 新增功能
- **三角形和星形纯图标化**：三角形和星形不再支持任何文字显示，成为纯图标标记
  - `TRIANGLE_UP` 和 `TRIANGLE_DOWN` 完全移除文字渲染功能
  - `STAR` 完全移除文字渲染功能
  - 这些形状专注于视觉图标表达，不承载文字信息
  
- **矩形固定12dp尺寸**：矩形标记大小固定为12dp，不受`markerSize`配置影响
  - 所有矩形标记都显示为统一的12dp × 12dp正方形
  - 提供一致的视觉效果，避免尺寸混乱
  - 仍然支持文字显示（英文/数字/符号）

### 🔧 技术实现
- 修改了`TriangleRenderer`和`StarRenderer`：
  - 移除了`textPaint`和相关文字绘制代码
  - 简化了渲染逻辑，提高性能
  - 减少了内存占用
  
- 修改了`RectangleTextRenderer`：
  - 新增`FIXED_SQUARE_SIZE_DP = 12f`常量
  - `getMarkerWidth()`和`getMarkerHeight()`返回固定值
  - 绘制逻辑使用固定尺寸，忽略`markerSize`配置

### 📋 形状功能分工
#### 支持中文字符：
- ✅ 圆形 (CIRCLE)
- ✅ 菱形 (DIAMOND)

#### 支持英文字符：
- ✅ 圆形 (CIRCLE)
- ✅ 菱形 (DIAMOND)  
- ✅ 矩形 (RECTANGLE) - 固定12dp大小

#### 纯图标（不支持文字）：
- 🔺 三角形 (TRIANGLE_UP/TRIANGLE_DOWN)
- ⭐ 星形 (STAR)

### 🎯 使用效果
```java
// 矩形：无论markerSize设置为多少，都显示为12dp正方形
MarkerData.createCustomMarker(date, "A", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.RECTANGLE)
        .markerSize(8f)  // 会被忽略
        .build()); // 实际显示为12dp

// 三角形：不显示文字，但大小可调
MarkerData.createCustomMarker(date, "文字不显示", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.TRIANGLE_UP)
        .markerSize(20f) // 这个设置有效
        .build()); // 显示20dp的三角形

// 星形：不显示文字，但大小可调
MarkerData.createCustomMarker(date, "文字不显示", 
    new MarkerConfig.Builder()
        .shape(MarkerShape.STAR)
        .markerSize(15f) // 这个设置有效
        .build()); // 显示15dp的星形
```

### 📝 示例更新
- 新增三角形和星形大小对比演示
- 新增矩形固定尺寸演示
- 更新文档说明各形状的功能定位

---

## v3.2.1 - 矩形固定正方形功能 (2024-01-XX)

### 🆕 新增功能
- **矩形固定正方形**：矩形标记现在始终显示为正方形，不因文字内容而改变尺寸
  - 无论文字内容长短，矩形都保持 `markerSize × markerSize` 的正方形
  - 确保视觉一致性，避免因文字长度不同而导致的形状差异
  - 文字仍然正常居中显示在正方形中

### 🔧 技术实现
- 修改了`RectangleTextRenderer`类：
  - `drawMarker()` 方法：移除文字尺寸计算，使用固定的正方形尺寸
  - `getMarkerWidth()` 和 `getMarkerHeight()` 方法：返回相同的固定尺寸
  - 简化了计算逻辑，提高了性能

### 🎯 使用效果
```java
// 无论文字长短，都显示为12dp × 12dp的正方形
MarkerData.createCustomMarker(date, "A", rectangleConfig);      // 正方形
MarkerData.createCustomMarker(date, "LONG", rectangleConfig);   // 仍然是正方形，只显示"L"
MarkerData.createCustomMarker(date, "", rectangleConfig);       // 空文字也是正方形
```

### 📝 示例更新
- 新增5个矩形标记演示不同场景下的正方形效果
- 包含无文字、单字符、多字符、不同尺寸的对比测试

---

## v3.2.0 - 中文字符显示限制功能 (2024-01-XX)

### 🆕 新增功能
- **中文字符形状限制**：实现了基于标记形状的中文字符显示限制
  - 只有圆形(CIRCLE)和菱形(DIAMOND)支持中文字符显示
  - 其他形状遇到中文字符时会隐藏文字内容
  - 英文、数字、符号在所有形状中都正常显示
  - TEXT ONLY模式不受任何限制

### 🔧 技术实现
- 在`TextUtils`类中新增了以下方法：
  - `containsChineseCharacters()` - 检测文本中是否包含中文字符
  - `isChineseSupportedShape()` - 检查形状是否支持中文字符
- 修改了`processMarkerText()`方法，增加中文字符的形状限制逻辑
- 支持完整的CJK字符集检测（基本区、扩展A区、扩展B区、兼容汉字）

### 📋 规则说明
#### 支持中文的形状：
- ✅ 圆形 (CIRCLE)
- ✅ 菱形 (DIAMOND)

#### 不支持中文的形状：
- ❌ 矩形 (RECTANGLE)
- ❌ 三角形 (TRIANGLE_UP/TRIANGLE_DOWN)
- ❌ 星形 (STAR)
- ❌ 箭头 (ARROW_UP/ARROW_DOWN)

#### 特殊情况：
- ✅ TEXT ONLY (NONE) - 不受限制
- ✅ DOT/CUSTOM_ICON - 本身不支持文字

### 🎯 使用示例
```java
// 支持中文 - 显示"买"
MarkerData.createCustomMarker(date, "买入", MarkerPresets.googleBlue())

// 不支持中文 - 不显示文字
MarkerData.createCustomMarker(date, "警告", 
    new MarkerConfig.Builder().shape(MarkerShape.RECTANGLE).build())

// 支持英文 - 显示"S"
MarkerData.createCustomMarker(date, "SELL", 
    new MarkerConfig.Builder().shape(MarkerShape.RECTANGLE).build())

// TEXT ONLY - 显示完整文字
new MarkerData(date, "中文业绩公告", 
    new MarkerConfig.Builder().shape(MarkerShape.NONE).build())
```

### 🔄 向后兼容
- 现有代码无需修改
- 英文和数字标记不受影响
- TEXT ONLY功能保持完全兼容

### 📝 文档更新
- 新增`中文字符显示限制说明.md`
- 更新示例代码演示所有使用场景
- 编译测试通过，功能稳定

---

## v3.1.0 - 文字长度限制和汉字居中优化 (2024-01-XX)

### 🆕 新增功能
- **文字长度限制**：所有有形状的标记最多显示1个字符（TEXT ONLY除外）
- **汉字居中优化**：使用FontMetrics进行精确的文字居中计算，特别优化汉字显示效果

### 🔧 技术实现
- 更新了所有文字渲染器：
  - `CircleTextRenderer` - 圆形标记渲染器
  - `RectangleTextRenderer` - 矩形标记渲染器
  - `DiamondTextRenderer` - 菱形标记渲染器
  - `TriangleRenderer` - 三角形标记渲染器
  - `ArrowRenderer` - 箭头标记渲染器
  - `StarRenderer` - 星形标记渲染器
  - `TextOnlyRenderer` - 纯文字渲染器（保持多字符支持）

### 📋 功能特点
- 智能文字处理：根据标记类型自动应用不同规则
- 精确居中算法：支持汉字、英文、数字、符号的完美居中
- 向后兼容：现有代码无需修改
- 性能优化：复用Paint对象，避免重复创建

---

## v3.0.0 - 颜色预设系统 (2024-01-XX)

### 🆕 新增功能
- **MarkerColors颜色预设类**：提供谷歌Logo四色、股票色彩、经典紫色等预设
- **MarkerPresets预设标记类**：提供常用标记的快速创建方法
- **颜色工具方法**：支持颜色变体生成（深色、浅色、透明度）

### 🎨 预设颜色
- 谷歌Logo四色：蓝色、红色、绿色、黄色
- 股票经典色：股票红、股票绿
- 经典紫色：菱形紫

### 📚 文档完善
- 完整的使用指南和示例
- 最佳实践建议
- API文档更新

---

## v2.0.0 - 基础标记系统 (2024-01-XX)

### 🆕 新增功能
- 多种标记形状支持
- 趋势区间背景功能
- 自定义配置系统
- 性能优化 