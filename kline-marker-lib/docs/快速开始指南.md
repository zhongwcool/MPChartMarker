# K线标记库快速开始指南

## 📁 项目结构

```
YourProject/
├── app/
│   ├── src/main/java/com/yourpackage/
│   │   ├── MainActivity.java
│   │   ├── KLineData.java
│   │   └── KLineDataAdapter.java
│   ├── src/main/res/layout/
│   │   └── activity_main.xml
│   └── build.gradle.kts
├── kline-marker-lib/          # 拷贝的库文件夹
├── settings.gradle.kts
└── build.gradle.kts
```

## 🔧 快速配置

### 1. settings.gradle.kts

```kotlin
rootProject.name = "Your Project"
include(":app")
include(":kline-marker-lib")  // 添加这行
```

### 2. app/build.gradle.kts

```kotlin
dependencies {
    implementation(project(":kline-marker-lib"))  // 添加这行
    implementation("com.github.PhilJay:MPAndroidChart:v3.1.0")
}
```

## 📱 最小可运行示例

### activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <com.github.mikephil.charting.charts.CombinedChart
        android:id="@+id/chart"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1" />

    <Button
        android:id="@+id/btnDemo"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_margin="16dp"
        android:text="添加标记和趋势" />

</LinearLayout>
```

### KLineData.java

```java
package com.yourpackage;

import java.util.Date;

public class KLineData {
    private Date date;
    private float open;
    private float close;
    private float high;
    private float low;
    private final float volume;

    public KLineData(Date date, float open, float close, float high, float low, float volume) {
        this.date = date;
        this.open = open;
        this.close = close;
        this.high = high;
        this.low = low;
        this.volume = volume;
    }

    // Getters
    public Date getDate() { return date; }
    public float getOpen() { return open; }
    public float getClose() { return close; }
    public float getHigh() { return high; }
    public float getLow() { return low; }
    public float getVolume() { return volume; }
}
```

### MyKLineDataAdapter.java

```java
package com.yourpackage;

import com.alex.klinemarker.data.KLineDataAdapter;
import java.util.Date;

public class MyKLineDataAdapter implements KLineDataAdapter<KLineData> {
    
    @Override
    public Date getDate(KLineData klineData) {
        return klineData.getDate();
    }
    
    @Override
    public float getOpen(KLineData klineData) {
        return klineData.getOpen();
    }
    
    @Override
    public float getClose(KLineData klineData) {
        return klineData.getClose();
    }
    
    @Override
    public float getHigh(KLineData klineData) {
        return klineData.getHigh();
    }
    
    @Override
    public float getLow(KLineData klineData) {
        return klineData.getLow();
    }
    
    @Override
    public float getVolume(KLineData klineData) {
        return klineData.getVolume();
    }
    
    @Override
    public float getXValue(KLineData klineData) {
        if (klineData.getDate() == null) return 0;
        long baseTime = 1704067200000L; // 2024-01-01 00:00:00 UTC
        long daysSinceBase = (klineData.getDate().getTime() - baseTime) / (24 * 60 * 60 * 1000);
        return (float) daysSinceBase;
    }
}
```

### MainActivity.java

```java
package com.yourpackage;

import android.graphics.Color;
import android.os.Bundle;
import android.widget.Button;
import androidx.appcompat.app.AppCompatActivity;

import com.alex.klinemarker.KLineMarkerManager;
import com.alex.klinemarker.data.MarkerData;
import com.alex.klinemarker.data.TrendRegion;
import com.github.mikephil.charting.charts.CombinedChart;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.*;

import java.util.*;

public class MainActivity extends AppCompatActivity {
    private CombinedChart chart;
    private KLineMarkerManager<KLineData> markerManager;
    private List<KLineData> klineDataList;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        chart = findViewById(R.id.chart);
        Button btnDemo = findViewById(R.id.btnDemo);

        setupChart();
        setupMarkerManager();
        generateAndSetData();

        btnDemo.setOnClickListener(v -> addMarkersAndTrends());
    }

    private void setupChart() {
        chart.getDescription().setEnabled(false);
        chart.setDrawGridBackground(false);
        
        XAxis xAxis = chart.getXAxis();
        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
        
        YAxis leftAxis = chart.getAxisLeft();
        leftAxis.setDrawGridLines(true);
        chart.getAxisRight().setEnabled(false);
    }

    private void setupMarkerManager() {
        markerManager = new KLineMarkerManager.Builder<KLineData>()
            .context(this)
            .chart(chart)
            .dataAdapter(new MyKLineDataAdapter())
            .build();
    }

    private void generateAndSetData() {
        // 生成30天的K线数据
        klineDataList = new ArrayList<>();
        Calendar calendar = Calendar.getInstance();
        calendar.add(Calendar.DAY_OF_YEAR, -30);
        
        float price = 100f;
        for (int i = 0; i < 30; i++) {
            float open = price + (float)(Math.random() * 2 - 1);
            float close = open + (float)(Math.random() * 4 - 2);
            float high = Math.max(open, close) + (float)(Math.random() * 2);
            float low = Math.min(open, close) - (float)(Math.random() * 2);
            float volume = (float)(Math.random() * 1000 + 500);
            
            klineDataList.add(new KLineData(
                (Date) calendar.getTime().clone(),
                open, close, high, low, volume
            ));
            
            price = close;
            calendar.add(Calendar.DAY_OF_YEAR, 1);
        }

        // 创建图表数据
        List<CandleEntry> candleEntries = new ArrayList<>();
        for (int i = 0; i < klineDataList.size(); i++) {
            KLineData data = klineDataList.get(i);
            candleEntries.add(new CandleEntry(i, 
                data.getHigh(), data.getLow(), 
                data.getOpen(), data.getClose()));
        }

        CandleDataSet candleDataSet = new CandleDataSet(candleEntries, "K线");
        candleDataSet.setDecreasingColor(Color.RED);
        candleDataSet.setIncreasingColor(Color.GREEN);
        candleDataSet.setDrawValues(false);

        CandleData candleData = new CandleData(candleDataSet);
        CombinedData combinedData = new CombinedData();
        combinedData.setData(candleData);

        chart.setData(combinedData);
        markerManager.setKLineData(klineDataList);
        chart.invalidate();
    }

    private void addMarkersAndTrends() {
        // 添加一些示例标记
        List<MarkerData> markers = new ArrayList<>();
        
        if (klineDataList.size() > 5) {
            // 买入标记
            markers.add(new MarkerData(
                klineDataList.get(5).getDate(),
                MarkerData.MarkerType.BUY,
                "买入"
            ));
        }
        
        if (klineDataList.size() > 15) {
            // 卖出标记
            markers.add(new MarkerData(
                klineDataList.get(15).getDate(),
                MarkerData.MarkerType.SELL,
                "卖出"
            ));
        }
        
        if (klineDataList.size() > 25) {
            // 数字标记
            markers.add(new MarkerData(
                klineDataList.get(25).getDate(),
                MarkerData.MarkerType.NUMBER,
                "1"
            ));
        }

        markerManager.setMarkers(markers);

        // 添加趋势区间示例
        List<TrendRegion> trendRegions = new ArrayList<>();
        if (klineDataList.size() > 10) {
            // 上涨趋势区间
            trendRegions.add(new TrendRegion(
                "2024-01-10", "2024-01-20", 3,
                "2024-01-21T10:00:00Z",
                TrendRegion.TrendType.RISING
            ));
        }

        markerManager.setTrendRegions(trendRegions);
        markerManager.refresh();
    }
}
```

## 🎯 5分钟验证

1. **拷贝库文件夹** `kline-marker-lib` 到您的项目根目录
2. **修改配置文件** `settings.gradle.kts` 和 `build.gradle.kts`
3. **复制上述代码** 创建 4 个文件
4. **运行应用** 查看K线图
5. **点击按钮** 查看标记和趋势区间效果

## 📈 预期效果

- 显示30天的模拟K线图
- 点击按钮后出现：
    - 第5天：绿色买入标记
    - 第15天：红色卖出标记
    - 第25天：数字标记"1"
    - 1月10日-20日：上涨趋势背景

## 🔗 下一步

成功运行后，参考 `K线标记库完整使用指南.md` 了解更多配置选项和高级功能。