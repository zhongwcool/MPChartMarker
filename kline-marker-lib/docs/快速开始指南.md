# Kçº¿æ ‡è®°åº“å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„

```
YourProject/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ src/main/java/com/yourpackage/
â”‚   â”‚   â”œâ”€â”€ MainActivity.java
â”‚   â”‚   â”œâ”€â”€ KLineData.java
â”‚   â”‚   â””â”€â”€ KLineDataAdapter.java
â”‚   â”œâ”€â”€ src/main/res/layout/
â”‚   â”‚   â””â”€â”€ activity_main.xml
â”‚   â””â”€â”€ build.gradle.kts
â”œâ”€â”€ kline-marker-lib/          # æ‹·è´çš„åº“æ–‡ä»¶å¤¹
â”œâ”€â”€ settings.gradle.kts
â””â”€â”€ build.gradle.kts
```

## ğŸ”§ å¿«é€Ÿé…ç½®

### 1. settings.gradle.kts

```kotlin
rootProject.name = "Your Project"
include(":app")
include(":kline-marker-lib")  // æ·»åŠ è¿™è¡Œ
```

### 2. app/build.gradle.kts

```kotlin
dependencies {
    implementation(project(":kline-marker-lib"))  // æ·»åŠ è¿™è¡Œ
    implementation("com.github.PhilJay:MPAndroidChart:v3.1.0")
}
```

## ğŸ“± æœ€å°å¯è¿è¡Œç¤ºä¾‹

### activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">

    <com.github.mikephil.charting.charts.CombinedChart
        android:id="@+id/chart"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1" />

    <Button
        android:id="@+id/btnDemo"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_margin="16dp"
        android:text="æ·»åŠ æ ‡è®°å’Œè¶‹åŠ¿" />

</LinearLayout>
```

### KLineData.java

```java
package com.yourpackage;

import java.util.Date;

public class KLineData {
    private Date date;
    private float open;
    private float close;
    private float high;
    private float low;
    private final float volume;

    public KLineData(Date date, float open, float close, float high, float low, float volume) {
        this.date = date;
        this.open = open;
        this.close = close;
        this.high = high;
        this.low = low;
        this.volume = volume;
    }

    // Getters
    public Date getDate() { return date; }
    public float getOpen() { return open; }
    public float getClose() { return close; }
    public float getHigh() { return high; }
    public float getLow() { return low; }
    public float getVolume() { return volume; }
}
```

### MyKLineDataAdapter.java

```java
package com.yourpackage;

import com.alex.klinemarker.data.KLineDataAdapter;
import java.util.Date;

public class MyKLineDataAdapter implements KLineDataAdapter<KLineData> {
    
    @Override
    public Date getDate(KLineData klineData) {
        return klineData.getDate();
    }
    
    @Override
    public float getOpen(KLineData klineData) {
        return klineData.getOpen();
    }
    
    @Override
    public float getClose(KLineData klineData) {
        return klineData.getClose();
    }
    
    @Override
    public float getHigh(KLineData klineData) {
        return klineData.getHigh();
    }
    
    @Override
    public float getLow(KLineData klineData) {
        return klineData.getLow();
    }
    
    @Override
    public float getVolume(KLineData klineData) {
        return klineData.getVolume();
    }
    
    @Override
    public float getXValue(KLineData klineData) {
        if (klineData.getDate() == null) return 0;
        long baseTime = 1704067200000L; // 2024-01-01 00:00:00 UTC
        long daysSinceBase = (klineData.getDate().getTime() - baseTime) / (24 * 60 * 60 * 1000);
        return (float) daysSinceBase;
    }
}
```

### MainActivity.java

```java
package com.yourpackage;

import android.graphics.Color;
import android.os.Bundle;
import android.widget.Button;
import androidx.appcompat.app.AppCompatActivity;

import com.alex.klinemarker.KLineMarkerManager;
import com.alex.klinemarker.data.MarkerData;
import com.alex.klinemarker.data.TrendRegion;
import com.github.mikephil.charting.charts.CombinedChart;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.*;

import java.util.*;

public class MainActivity extends AppCompatActivity {
    private CombinedChart chart;
    private KLineMarkerManager<KLineData> markerManager;
    private List<KLineData> klineDataList;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        chart = findViewById(R.id.chart);
        Button btnDemo = findViewById(R.id.btnDemo);

        setupChart();
        setupMarkerManager();
        generateAndSetData();

        btnDemo.setOnClickListener(v -> addMarkersAndTrends());
    }

    private void setupChart() {
        chart.getDescription().setEnabled(false);
        chart.setDrawGridBackground(false);
        
        XAxis xAxis = chart.getXAxis();
        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
        
        YAxis leftAxis = chart.getAxisLeft();
        leftAxis.setDrawGridLines(true);
        chart.getAxisRight().setEnabled(false);
    }

    private void setupMarkerManager() {
        markerManager = new KLineMarkerManager.Builder<KLineData>()
            .context(this)
            .chart(chart)
            .dataAdapter(new MyKLineDataAdapter())
            .build();
    }

    private void generateAndSetData() {
        // ç”Ÿæˆ30å¤©çš„Kçº¿æ•°æ®
        klineDataList = new ArrayList<>();
        Calendar calendar = Calendar.getInstance();
        calendar.add(Calendar.DAY_OF_YEAR, -30);
        
        float price = 100f;
        for (int i = 0; i < 30; i++) {
            float open = price + (float)(Math.random() * 2 - 1);
            float close = open + (float)(Math.random() * 4 - 2);
            float high = Math.max(open, close) + (float)(Math.random() * 2);
            float low = Math.min(open, close) - (float)(Math.random() * 2);
            float volume = (float)(Math.random() * 1000 + 500);
            
            klineDataList.add(new KLineData(
                (Date) calendar.getTime().clone(),
                open, close, high, low, volume
            ));
            
            price = close;
            calendar.add(Calendar.DAY_OF_YEAR, 1);
        }

        // åˆ›å»ºå›¾è¡¨æ•°æ®
        List<CandleEntry> candleEntries = new ArrayList<>();
        for (int i = 0; i < klineDataList.size(); i++) {
            KLineData data = klineDataList.get(i);
            candleEntries.add(new CandleEntry(i, 
                data.getHigh(), data.getLow(), 
                data.getOpen(), data.getClose()));
        }

        CandleDataSet candleDataSet = new CandleDataSet(candleEntries, "Kçº¿");
        candleDataSet.setDecreasingColor(Color.RED);
        candleDataSet.setIncreasingColor(Color.GREEN);
        candleDataSet.setDrawValues(false);

        CandleData candleData = new CandleData(candleDataSet);
        CombinedData combinedData = new CombinedData();
        combinedData.setData(candleData);

        chart.setData(combinedData);
        markerManager.setKLineData(klineDataList);
        chart.invalidate();
    }

    private void addMarkersAndTrends() {
        // æ·»åŠ ä¸€äº›ç¤ºä¾‹æ ‡è®°
        List<MarkerData> markers = new ArrayList<>();
        
        if (klineDataList.size() > 5) {
            // ä¹°å…¥æ ‡è®°
            markers.add(new MarkerData(
                klineDataList.get(5).getDate(),
                MarkerData.MarkerType.BUY,
                "ä¹°å…¥"
            ));
        }
        
        if (klineDataList.size() > 15) {
            // å–å‡ºæ ‡è®°
            markers.add(new MarkerData(
                klineDataList.get(15).getDate(),
                MarkerData.MarkerType.SELL,
                "å–å‡º"
            ));
        }
        
        if (klineDataList.size() > 25) {
            // æ•°å­—æ ‡è®°
            markers.add(new MarkerData(
                klineDataList.get(25).getDate(),
                MarkerData.MarkerType.NUMBER,
                "1"
            ));
        }

        markerManager.setMarkers(markers);

        // æ·»åŠ è¶‹åŠ¿åŒºé—´ç¤ºä¾‹
        List<TrendRegion> trendRegions = new ArrayList<>();
        if (klineDataList.size() > 10) {
            // ä¸Šæ¶¨è¶‹åŠ¿åŒºé—´
            trendRegions.add(new TrendRegion(
                "2024-01-10", "2024-01-20", 3,
                "2024-01-21T10:00:00Z",
                TrendRegion.TrendType.RISING
            ));
        }

        markerManager.setTrendRegions(trendRegions);
        markerManager.refresh();
    }
}
```

## ğŸ¯ 5åˆ†é’ŸéªŒè¯

1. **æ‹·è´åº“æ–‡ä»¶å¤¹** `kline-marker-lib` åˆ°æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•
2. **ä¿®æ”¹é…ç½®æ–‡ä»¶** `settings.gradle.kts` å’Œ `build.gradle.kts`
3. **å¤åˆ¶ä¸Šè¿°ä»£ç ** åˆ›å»º 4 ä¸ªæ–‡ä»¶
4. **è¿è¡Œåº”ç”¨** æŸ¥çœ‹Kçº¿å›¾
5. **ç‚¹å‡»æŒ‰é’®** æŸ¥çœ‹æ ‡è®°å’Œè¶‹åŠ¿åŒºé—´æ•ˆæœ

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

- æ˜¾ç¤º30å¤©çš„æ¨¡æ‹ŸKçº¿å›¾
- ç‚¹å‡»æŒ‰é’®åå‡ºç°ï¼š
    - ç¬¬5å¤©ï¼šç»¿è‰²ä¹°å…¥æ ‡è®°
    - ç¬¬15å¤©ï¼šçº¢è‰²å–å‡ºæ ‡è®°
    - ç¬¬25å¤©ï¼šæ•°å­—æ ‡è®°"1"
    - 1æœˆ10æ—¥-20æ—¥ï¼šä¸Šæ¶¨è¶‹åŠ¿èƒŒæ™¯

## ğŸ”— ä¸‹ä¸€æ­¥

æˆåŠŸè¿è¡Œåï¼Œå‚è€ƒ `Kçº¿æ ‡è®°åº“å®Œæ•´ä½¿ç”¨æŒ‡å—.md` äº†è§£æ›´å¤šé…ç½®é€‰é¡¹å’Œé«˜çº§åŠŸèƒ½ã€‚